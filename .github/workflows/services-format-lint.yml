# Check formatting and lint all Yarn workspaces as soon as there is a new pull request
name: "Services â€“ Format and Lint"

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - master

jobs:
  format-and-lint:
    name: Format and lint
    runs-on: ubuntu-latest
    steps:
      - name: Checkout the branch
        uses: actions/checkout@v2.3.1

      - name: Create a new .env file
        uses: SpicyPizza/create-envfile@v1
        with:
          envkey_AUTH0_SECRET: ${{ secrets.AUTH0_SECRET }}
          envkey_AUTH0_BASE_URL: ${{ secrets.AUTH0_BASE_URL_STAGING }}
          envkey_AUTH0_ISSUER_BASE_URL: ${{ secrets.AUTH0_ISSUER_BASE_URL }}
          envkey_AUTH0_CLIENT_ID: ${{ secrets.AUTH0_CLIENT_ID }}
          envkey_AUTH0_CLIENT_SECRET: ${{ secrets.AUTH0_CLIENT_SECRET }}
          file_name: .env.production

      - name: Install dependencies
        uses: borales/actions-yarn@v2.3.0
        with:
          cmd: install --silent

      - name: Check formatting
        uses: borales/actions-yarn@v2.3.0
        with:
          cmd: format

      - name: Check linting
        uses: borales/actions-yarn@v2.3.0
        with:
          cmd: lint
